define(function() {
function encodeHTMLSource() {  var encodeHTMLRules = { "&": "&#38;", "<": "&#60;", ">": "&#62;", '"': '&#34;', "'": '&#39;', "/": '&#47;' },  matchHTML = /&(?!#?w+;)|<|>|"|'|\//g;  return function() {    return this ? this.replace(matchHTML, function(m) {return encodeHTMLRules[m] || m;}) : this;  };};
String.prototype.encodeHTML=encodeHTMLSource();
var tmpl = {};
  tmpl['search']=function anonymous(it) {
var out='<div class="search-layout js-search" data-content="search"><input class="search js-search-input" type="text" placeholder="'+(it.i18n_placeholder)+'"></input></div>';return out;
};
  tmpl['Condition']=function anonymous(it) {
var out='<div class="condition" data-row="'+(it.row)+'"><label class="condition-statement">'+(it.statement)+'</label><div class="condition-vertical"></div>'+(it.firstOperand)+'<div class="condition-vertical"></div><div class="condition-operators condition-item"> <span class="condition-operators-value">'+(it.operator)+'</span> <ul class="condition-operators-list condition-dropdown "> '; for(var prop in it.operators) { out+=' <li class="condition-operator condition-dropdown-list-item ';if(it.operators[prop] === '+(it.operator)+'){out+='checked';}out+='" data-value="'+(it.operators[prop]||'').toString().encodeHTML()+'"> <span class="condition-operator-symbol">'+(it.operators[prop]||'').toString().encodeHTML()+'</span> <span class="condition-operator-text">'+(prop)+'</span> <i class="condition-check sp-default sp-default-check"></i> </li> '; } out+=' </ul></div><div class="condition-vertical"></div>'+(it.lastOperand)+'<div class="condition-vertical"></div><div class="condition-then condition-item"> then <ul class="condition-comparators condition-dropdown"> '; for(var prop in it.additionalCompairOperators) { out+=' <li class="condition-comparator condition-dropdown-list-item" data-value="'+(it.additionalCompairOperators[prop])+'">'+(prop)+'</li> '; } out+=' </ul></div><div class="condition-vertical"></div><div class="condition-exit"><span class="condition-exit-background"><i class="condition-exit-icon js-condition-exit sp-default sp-default-exit"></i></span></div></div>';return out;
};
  tmpl['ConditionElse']=function anonymous(it) {
var out='<div class="condition condition-else" data-row="'+(it.row)+'"><label class="condition-statement">else</label></div>';return out;
};
  tmpl['ConditionOperand']=function anonymous(it) {
var out='<div class="condition-operand condition-item condition-'+(it.order)+'-operand"><span class="condition-value">'+(it.value)+'</span><ul class="condition-operands condition-dropdown">';var arr1=it.vars;if(arr1){var variable,index=-1,l1=arr1.length-1;while(index<l1){variable=arr1[index+=1];out+='<li class="condition-variable-operand condition-dropdown-list-item ';if(variable === it.value){out+='checked';}out+='" data-value="'+(variable)+'">'+(variable)+'<i class="condition-check sp-default sp-default-check"></i></li>';} } out+='<li class="condition-custom-operand ';if(!/^\$\{/.test(it.value)){out+='checked';}out+='"><input class="condition-custom-operand-input js-condition-custom-operand-input" placeholder="Enter custom value" value="';if(!/^\$\{/.test(it.value)){out+=(it.value);}out+='"><i class="condition-check sp-default sp-default-check"></i></li><li class="condition-custom-operand-info">Press enter to submit.</li></ul></div>';return out;
};
  tmpl['Input']=function anonymous(it) {
var out='<input type="text" class="input" value="'+(it.value)+'" data-row="'+(it.row)+'"></input>';return out;
};
  tmpl['Translation']=function anonymous(it) {
var out='<div class="translation" data-content="translation"><h1 class="translation-title">'+(it.key)+'</h1><form class="translation-form"><div class="translation-variables"><label class="translation-sub-title">'+(it.i18n_variables)+'</label><ul class="translation-variables-list">';if(it.vars.length > 0){var arr1=it.vars;if(arr1){var variable,index=-1,l1=arr1.length-1;while(index<l1){variable=arr1[index+=1];out+='<li class="translation-variable">'+(variable)+'</li>';} } }else{out+='<li class="translation-variable">'+(it.i18n_none)+'</li>';}out+='</ul></div><div class="translation-inputs clearfix"><label class="translation-sub-title">'+(it.i18n_translation)+'</label><div class="translation-values">'+(it.values)+'</div><div class="translation-actions"><button class="save button" type="submit" disabled>'+(it.i18n_save)+'</button><button class="add-condition button" type="button" disabled>'+(it.i18n_addCondition)+'</button></div></div></form></div>';return out;
};
  tmpl['translations']=function anonymous(it) {
var out='<table class="translations" data-content="translations"><thead class="translations-headers"><tr><th class="translation-col translations-header">'+(it.metas.l10n_keys)+'</th><th class="translation-col translations-header">'+(it.metas.l10n_values)+'</th></tr></thead><tbody>';var arr1=it;if(arr1){var translation,index=-1,l1=arr1.length-1;while(index<l1){translation=arr1[index+=1];out+='<tr class="translation" data-id="'+(translation.id)+'"><td class="translation-col translation-key">'+(translation.key)+'</td><td class="translation-col translation-value">'+(translation.text.replace('\n', '<br>'))+'</td></tr>';} } out+='</tbody></table>';return out;
};
  tmpl['compositeRouter']=function anonymous(it) {
var out='define([\'backbone\',\'jquery\',';var arr1=it.imports;if(arr1){var _import,index=-1,l1=arr1.length-1;while(index<l1){_import=arr1[index+=1];out+='\''+(_import.view.path)+'\',\''+(_import.model.path)+'\'';if(index !== it.imports.length - 1){out+=',';}} } out+='], function(Backbone,$,';var arr2=it.imports;if(arr2){var _import,index=-1,l2=arr2.length-1;while(index<l2){_import=arr2[index+=1];out+=(_import.view.name)+','+(_import.model.name);if(index !== it.imports.length - 1){out+=',';}} } out+=') {var Constructor = Backbone.Router.extend({routes : {';var arr3=it.pages;if(arr3){var page,index=-1,l3=arr3.length-1;while(index<l3){page=arr3[index+=1];out+='\''+(page.path)+'\' : \'compose '+(page.path)+'\'';if(index !== it.pages.length - 1){out+=',';}} } out+='},';var arr4=it.pages;if(arr4){var page,index=-1,l4=arr4.length-1;while(index<l4){page=arr4[index+=1];out+='\'compose '+(page.path)+'\' : function() {var _this = this, incorrectRegions = 0, n = 0;app.document.trigger(\'fetchstart\', \''+(page.path)+'\');'+(page.contentScript)+'for(var view in app.views) {if('+(page.noViewsScript)+') {app.views[view].remove();delete app.views[view];if(typeof app.models[view] !== \'undefined\') {Backbone.Relational.store.unregister(app.models[view]);}}}},';} } var arr5=it.pages;if(arr5){var page,index=-1,l5=arr5.length-1;while(index<l5){page=arr5[index+=1];out+='\'render '+(page.path)+'\' : function() {app.document.trigger(\'renderstart\');if(document.querySelectorAll(\'[data-layout='+(page.layout)+']\').length) {'+(page.renderScript)+'}else {app.$layout.remove();app.$body.append(app.layoutTmpls.'+(page.layout)+'({'+(page.mapScript)+'}));}app.document.trigger(\'renderend\');},';} } out+='});Constructor.prototype.content = {};return Constructor;});';return out;
};
  tmpl['contentScript']=function anonymous(it) {
var out='';var arr1=it;if(arr1){var content,index=-1,l1=arr1.length-1;while(index<l1){content=arr1[index+=1];out+='if(typeof app.models.'+(content.model.toLowerCase())+' === \'undefined\' || typeof app.views.'+(content.model.toLowerCase())+' === \'undefined\') {app.models.'+(content.model.toLowerCase())+' = new '+(content.model)+';app.views.'+(content.model.toLowerCase())+' = new '+(content.view)+'(app.models.'+(content.model.toLowerCase())+');incorrectRegions++;setTimeout(function() {try {app.models.'+(content.model.toLowerCase())+'.fetch({success: function() {_this.content[\''+(content.region)+'\'] = app.views.'+(content.model.toLowerCase())+'.render();if(typeof app.views.'+(content.model.toLowerCase())+'.bindModel === \'function\') {app.views.'+(content.model.toLowerCase())+'.bindModel();}n++;if(n === incorrectRegions) {app.document.trigger(\'fetchend\', \''+(content.path)+'\');_this[\'render '+(content.path)+'\']();}}});}catch(err) {if(err.message === \'A "url" property or function must be specified\') {_this.content[\''+(content.region)+'\'] = app.views.'+(content.model.toLowerCase())+'.render();n++;if(n === incorrectRegions) {app.document.trigger(\'fetchend\', \''+(content.path)+'\');_this[\'render '+(content.path)+'\']();}}else {throw err;}}}, 0);}else {app.models.'+(content.model.toLowerCase())+'.onHistoryChange(window.location.pathname.substr(1));app.views.'+(content.model.toLowerCase())+'.onHistoryChange(window.location.pathname.substr(1));}';} } return out;
};
  tmpl['mapScript']=function anonymous(it) {
var out='';var arr1=it;if(arr1){var content,index=-1,l1=arr1.length-1;while(index<l1){content=arr1[index+=1];out+=(content.region)+' : this.content[\''+(content.model.toLowerCase())+'\']';if(index !== it.length - 1){out+=',';}} } return out;
};
  tmpl['noViewsScript']=function anonymous(it) {
var out='';var arr1=it;if(arr1){var view,index=-1,l1=arr1.length-1;while(index<l1){view=arr1[index+=1];out+='view !== \''+(view)+'\'';if(index !== it.length - 1){out+=' && ';}} } return out;
};
  tmpl['renderScript']=function anonymous(it) {
var out='';var arr1=it;if(arr1){var content,index=-1,l1=arr1.length-1;while(index<l1){content=arr1[index+=1];out+='app.document.trigger(\'render'+(content.model.toLowerCase())+'start\');try {if(!document.querySelector(\'[data-content="'+(content.model.toLowerCase())+'"]\')) {var $region = document.querySelector(\'[data-region="'+(content.region)+'"]\');$region.innerHTML = this.content[\''+(content.region)+'\'];$region.classList.remove(\'hidden\');}if(app.views.el !== \'<div></div>\') {app.views.'+(content.model.toLowerCase())+'.setElement(\'[data-content="'+(content.model.toLowerCase())+'"]\');}if(!app.views.'+(content.model.toLowerCase())+'.boundDOM) {app.views.'+(content.model.toLowerCase())+'.bindDOM();app.views.'+(content.model.toLowerCase())+'.boundDOM = true;}}catch(err) {throw err;}app.document.trigger(\'render'+(content.model.toLowerCase())+'end\');';} } return out;
};
  tmpl['jsonScript']=function anonymous(it) {
var out='<script type="application/json" class="js-json-'+(it.name)+'">'+(it.json)+'</script>';return out;
};
  tmpl['default']=function anonymous(it) {
var out='<!DOCTYPE html><html lang="'+(it.locale)+'" class="locale-'+(it.locale)+'"><head><script src="'+(it.modernizr)+'"></script><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta charset="utf-8"><meta name="viewport" content="width=device-width, user-scalable=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="description" content="'+(it.description)+'"><link rel="icon" type="image/x-icon" href="/public/favicon.ico"/><title>'+(it.title)+'</title><script>(function(Modernizr) { var image = new Image(); image.onerror = function() { Modernizr.addTest(\'webpalpha\', false); }; image.onload = function() { Modernizr.addTest(\'webpalpha\', image.width === 1); }; image.src = \'data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA==\';})(Modernizr);</script>';var arr1=it.styles;if(arr1){var href,index=-1,l1=arr1.length-1;while(index<l1){href=arr1[index+=1];out+='<link href="'+(href)+'" rel="stylesheet" type="text/css">';} } out+='<script>window.inServer = false;window.inClient = true;window.has = Modernizr;window.no = Modernizr;if(typeof String.prototype.toFirstLetterUpperCase === \'undefined\') { String.prototype.toFirstLetterUpperCase = function() { return this.charAt(0).toUpperCase() + this.slice(1); };}</script></head><body>';var arr2=it.configurations;if(arr2){var configuration,index=-1,l2=arr2.length-1;while(index<l2){configuration=arr2[index+=1];out+=' <script src="'+(configuration)+'"></script>';} } var arr3=it.scripts;if(arr3){var src,index=-1,l3=arr3.length-1;while(index<l3){src=arr3[index+=1];out+='<script src="'+(src)+'" type="text/javascript"></script>';} } out+=(it.layout)+(it.jsonScripts)+'<script data-main="'+(it.main)+'" src="'+(it.requirejs)+'"></script></body></html>';return out;
};
  tmpl['app']=function anonymous(it) {
var out='<div class="app" data-layout="app"><header class="app-header"><div class="app-search" data-region="search">'+(it.search)+'</div></header><div class="app-translations ';if(it.translation){out+='hidden';}out+='" data-region="body">'+(it.body)+'</div><div class="app-translation ';if(!it.translation){out+='hidden';}out+='" data-region="translation">';if(it.translation){out+=(it.translation);}out+='</div></div>';return out;
};
  tmpl['JSONTranslationFunctionField']=function anonymous(it) {
var out='\''+(it.key)+'\' : '+(it.functionString);return out;
};
  tmpl['additionalCondition']=function anonymous(it) {
var out=''+(it.additionalCondition)+' '+(it.operand1)+' '+(it.operator)+' '+(it.operand2);return out;
};
  tmpl['condition']=function anonymous(it) {
var out=''+(it.condition)+'('+(it.operand1)+' '+(it.operator)+' '+(it.operand2);return out;
};
  tmpl['conditionBody']=function anonymous(it) {
var out=') {return \''+(it.string)+'\';}';return out;
};
  tmpl['elseStatement']=function anonymous(it) {
var out='else {return \''+(it.string)+'\';}';return out;
};
  tmpl['javascriptWrapper']=function anonymous(it) {
var out=';(function() {'+(it.translationMap)+'function gt(key) { if(!(key in t)) { return \'KEY_NOT_IN_SOURCE: \' + key; } return t[key].apply(undefined, arguments);};if(typeof require === "function" && typeof exports === \'object\' && typeof module === \'object\') {module.exports = gt;}else if (typeof define === "function" && define.amd) {define(function () {return gt;});}else {window.'+(it.variable)+' = gt;}})();';return out;
};
  tmpl['mapDeclaration']=function anonymous(it) {
var out='var t = {'+(it.body)+'};';return out;
};
  tmpl['nonConditionFunctionBody']=function anonymous(it) {
var out='return \''+(it.string)+'\';';return out;
};
  tmpl['nonTranslatedFunctionBody']=function anonymous(it) {
var out='return \'KEY_NOT_TRANSLATED: \' + \''+(it.key)+'\';';return out;
};
  tmpl['footer']=function anonymous(it) {
var out='';var arr1=it.footerInfo;if(arr1){var footerInfo,index=-1,l1=arr1.length-1;while(index<l1){footerInfo=arr1[index+=1];out+='<tr><td style="font-size: 10px; font-weight: 100; color: #878787;"><table><tr><td style="padding-right: 40px;"><p style="color: #a6a6a6; display: inline; font-size: 10px; font-family: \'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif; padding-bottom: 20px;">'+(footerInfo.copyright)+'</p></td></tr></table></td><td><table><tr><td style="padding-right: 40px; margin-bottom: 30px;"><a href="mailto:'+(footerInfo.emailAddress)+'" style="font-size: 10px; font-weight: 100; color:#6699cc; text-decoration: none; font-family: \'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif;">'+(footerInfo.emailName)+'</a></td></tr></table></td></tr>';} } return out;
};
  tmpl['hero']=function anonymous(it) {
var out='';var arr1=it.hero;if(arr1){var hero,index=-1,l1=arr1.length-1;while(index<l1){hero=arr1[index+=1];out+='<tr><td background="'+(hero.background)+'" valign="top" width="604" align="center" height="480" style="background-color: '+(hero.backgroundColor)+'; text-align: center;"><!--[if gte mso 9]><v:image xmlns:v="urn:schemas-microsoft-com:vml" id="theImage" style=\'behavior: url(#default#VML); display:inline-block; position:absolute; height:480px; width:602px; top:0; left:0; border:0; z-index:1;\' src="http://static.p1.com/email/images/tantan-email-header.png"/><v:shape xmlns:v="urn:schemas-microsoft-com:vml" id="theText" style=\'behavior: url(#default#VML); display:inline-block; position:absolute; height:480px; width:602px; top:-5; left:-10; border:0; z-index:2;\'><![endif]--><table><tr><td><table width="604" cellspacing="0" cellpadding="0" border="0"><tr><td height="40"></td></tr><tr><td align="center"><img style="margin: 0; border: 0; padding: 0; display: block;" src="http://static.p1.com/email/images/tantan-logo.png"></td></tr></table></td></tr><tr><td><table align="center"><tr><td height="6"></td></tr><tr><td width="218" height="92" align="center" valign="middle"><h1 style="color: #d44831; font-size: 60px; font-weight: 100; text-align: center; font-family: \'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif; margin: 0;">'+(hero.title)+'</h1></td></tr><tr><td height="5"></td></tr><tr><td><h4 style="color: #424242; font-size: 24px; font-weight: 100; text-align: center; font-family: \'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif;margin: 0;">'+(hero.slogen)+'</h4></td></tr><tr><td height="20"></td></tr></table></td></tr><!-- download buttons --><!-- <tr> <td> <table width="604" cellspacing="0" cellpadding="0" border="0"> <tr> <td align="center"> <table height="227" bgcolor="#d44831" style="background: #d44831; border-radius: 4px; overflow: hidden; display: inline-block;"> <tr> <td colspan="3" height="2"> </td> </tr> <tr> <td width="30"></td> <td style="text-align: center; color: #ffffff;"> <a style="font-family:\'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif; text-decoration: none; color: #ffffff; font-size: 22px; font-weight: 500;" href="http://tantanapp.cn"> 下载<span style="font-weight:200;">iPhone</span>应用 </a> </td> <td width="30"></td> </tr> <tr> <td colspan="3" height="2"> </td> </tr> </table> </td> </tr> </table> </td></tr> --><tr> <td> <table width="604" cellspacing="0" cellpadding="0" border="0"> <tr> <td align="center"> <table> <tr> <td height="10"> </td> </tr> <tr> <td> <table bgcolor="#007aff" style="background: #007aff; border-radius: 4px; overflow: hidden; display: inline-block;"> <tr> <td colspan="3" height="2"> </td> </tr> <tr> <td width="30"></td> <td style="text-align: center; color: #ffffff;"> <a style="font-family:\'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif; text-decoration: none; color: #ffffff; font-size: 22px; font-weight: 300;" href="http://tantanapp.cn">下载<span style="font-weight:200;">iPhone</span>应用</a> </td> <td width="30"></td> </tr> <tr> <td colspan="3" height="2"> </td> </tr> </table> </td> <td width="10"> </td> <td> <table bgcolor="#4dd865" style="background: #4dd865; border-radius: 4px; overflow: hidden; display: inline-block;"> <tr> <td colspan="3" height="2"> </td> </tr> <tr> <td width="30"></td> <td style="text-align: center; color: #ffffff;"> <a style="font-family:\'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif; text-decoration: none; color: #ffffff; font-size: 22px; font-weight: 300;" href="http://tantanapp.cn">下载安卓应用</a> </td> <td width="30"></td> </tr> <tr> <td colspan="3" height="2"> </td> </tr> </table> </td> </tr> </table> </td> </tr> </table> </td></tr><tr><td><table  align="center"><tr><td height="2"></td></tr><tr><td><p style="color: #424242; font-size: 14px; font-weight: 100; text-align: center; font-family: \'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif; margin: 0;">免费下载<span style="font-weight:200;">iPhone</span>应用</p></td></tr><tr><td height="20"></td></tr></table></td></tr></table></td><!--[if gte mso 9]></v:shape><![endif]--></tr>';} } return out;
};
  tmpl['html']=function anonymous(it) {
var out='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional //EN"><html><head><title></title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head><body style="position: relative; font-family:\'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif;" dir="ltr"><table width="600" align="center"><tr><td style="text-align: center; padding: 5px 0px 5px;"><span style="color: #999999; font-size: 10px; font-family: \'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif;"></span></td></tr><tr><td align="center" style="padding-bottom: 40px;"><table width="604" cellspacing="0" cellpadding="0" class="root" style="border-collapse: collapse; border-radius: 5px; -webkit-border-radius: 5px; overflow: hidden; background-color: #fff;" border="0"><tr><td><p style="text-align: center; color: #a6a6a6; display: block; font-size: 10px; font-family: \'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif; margin: 10px 0;">English version can be found <a href="http://tantanapp.com/emails/invitation.html" style="color:#6699cc;">here</a>.</p><td></tr><!-- header -->'+(it.hero)+'<!-- promos -->'+(it.promos)+'<!-- footer -->'+(it.footer)+'</table></td></tr></table></body></html>';return out;
};
  tmpl['promos']=function anonymous(it) {
var out='';var arr1=it.promos;if(arr1){var promo,index=-1,l1=arr1.length-1;while(index<l1){promo=arr1[index+=1];out+='<tr><td><table style="margin-bottom: 60px;"><tr><td valign="middle" width="90" align="left" style="font-size: 12px;"><table><tr><td height ="30"></td></tr><tr><td><img width="60" height="60" style="display:block;" src="'+(promo.icon||'').toString().encodeHTML()+'"></td></tr></table></td><td><h3 style="font-weight: 200; font-family: \'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif; font-size: 28px; margin: 30px 0; text-align: left;">'+(promo.title)+'</h3><p style="color: #636363; font-size: 20px; font-family:\'Helvetica Neue\', arial, \'Hiragino Sans GB\', \'Microsoft Yahei\', sans-serif; font-weight: 200; text-align: left;">'+(promo.description)+'</p></td></tr></table></td></tr>';} } return out;
};
return tmpl;});
